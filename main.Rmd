---
title: "Community Gardens Map"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}

library(tidyverse)
library(plotly)
library(leaflet)
library(ggridges)

#Set global theme for plots
theme_set(theme_minimal() + 
            theme(legend.position = "bottom", 
                  axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)))
#Set options for all plots
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


```{r include=FALSE}
garden =
  read_csv("./data/final_df.csv") %>%
  group_by(community_board) %>%
  select(community_board, borough, overall_pop, race_white:college_higher, garden_name:longitude)

garden_num = 
  garden %>% 
  drop_na(garden_name) %>% 
  group_by(community_board) %>% 
  summarize(garden_num = n())

garden_tidy = 
  left_join(garden, garden_num, by = "community_board")

```


### Garden Locations around NYC 

```{r, echo = FALSE, warning = FALSE}
leafIcons <- icons(
  iconUrl = ifelse(garden_tidy$size > 0.55,
    "http://leafletjs.com/examples/custom-icons/leaf-orange.png",
    "http://leafletjs.com/examples/custom-icons/leaf-green.png"
  ),
  iconWidth = 20, iconHeight = 30,
  iconAnchorX = 22, iconAnchorY = 94,
)

garden_tidy %>%
   mutate(
    click_label =
      str_c("<b>", garden_name, "</b><br>", borough, "</b><br>", size, " acres")) %>% 
  leaflet() %>%
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addMarkers(~longitude, ~latitude, icon = leafIcons, popup = ~click_label)

```


### Number of gardens by Community Board

```{r, echo = FALSE, warning = FALSE}
number_borough = 
  garden_tidy %>% 
  select(community_board, garden_num, borough) %>% 
  distinct() %>% 
  mutate(
    community_board = as.factor(community_board)
  )


number_borough[is.na(number_borough)] <- 0 

number_borough %>%
  mutate(text_label = str_c("Number of Gardens: ", garden_num, "\nBorough: ", borough)
         ) %>% 
    plot_ly(
      x = ~community_board, y = ~garden_num, text = ~text_label, color = ~borough, 
      type = "bar", colors = "viridis"
            ) %>% 
        layout(autosize = F, width = 900, xaxis = list(
          title = "Community Board", tickmode = "linear"), yaxis = list(title = "Number of Community Gardens", dtick = 5))
```

### Proportion of different Age Groups by Community Board

```{r, echo = FALSE, warning = FALSE}

garden_tidy %>% 
  select(community_board,age0to17:age65plus) %>% 
  distinct() %>% 
  group_by(community_board) %>% 
  drop_na() %>% 
  knitr::kable()

age_borough = subset(garden, select = c(borough, age0to17:age65plus))

age_borough %>% 
  group_by(borough) %>% 
  summarize(
    avg_017 = mean(age0to17),
    avg_1824 = mean(age18to24),
    avg_2544 = mean(age25to44),
    avg_4564 = mean(age45to64),
    avg_65pl = mean(age65plus)
  ) %>% 
  knitr::kable()
```



### Proportion of different Education level Groups by Community Board


```{r, echo = FALSE, warning = FALSE, include = FALSE}

garden_tidy %>% 
  select(community_board, on_time_hs_grad:college_higher) %>% 
  distinct() %>% 
  group_by(community_board) %>% 
  drop_na() %>% 
  knitr::kable()

edu_borough = subset(garden, select = c(borough, on_time_hs_grad:college_higher))

edu_borough %>% 
  group_by(borough) %>% 
  summarize(
    hs_grad = mean(on_time_hs_grad),
    no_hs = mean(not_complete_hs),
    some_college = mean(hs_some_college),
    college_high = mean(college_higher)
  ) %>% 
  knitr::kable()
```


### Proportion of different Races Groups by Community Board


```{r, echo = FALSE, warning = FALSE, include = FALSE}

garden_tidy %>% 
  select(community_board, race_white:race_other) %>% 
  distinct() %>% 
  group_by(community_board) %>% 
  drop_na() %>% 
  knitr::kable()

race_borough = subset(garden, select = c(borough, race_white:race_other))

race_borough %>% 
  group_by(borough) %>% 
  summarize(
    avg_white = mean(race_white),
    avg_black = mean(race_black),
    avg_asian = mean(race_asian),
    avg_latino = mean(race_latino),
    avg_other = mean(race_other)
  ) %>% 
  knitr::kable()
```












