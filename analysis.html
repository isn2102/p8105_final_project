<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Statistical Analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="main.html">Garden Map</a>
</li>
<li>
  <a href="analysis.html">Analysis</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exposure Visualizations
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="health.html">Health Conditions</a>
    </li>
    <li>
      <a href="property_values.html">Economic Investment</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="https://www.youtube.com/">
    <span class="fa fa-youtube fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/isn2102/p8105_final_project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Statistical Analysis</h1>

</div>


<p>Load data and select variables. We had to remove one community district that didn’t have any neighbors because in order to successfully run the spatial regression all community districts have to have neighbors.</p>
<div id="choosing-dependent-variables" class="section level3">
<h3>Choosing dependent variables</h3>
<p>Check linearity of the relationship between garden number and potential outcome. All outcomes have a somewhat linear association, however seems like the variance is not constant, which may lead to issues later. We tried transforming x (garden num) to log to see linear relationship but this resulted in an eventual error doing the spatial regression.</p>
<pre class="r"><code>poverty_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = poverty)) +
  geom_point()

obesity_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = obesity)) +
  geom_point()

hypertension_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = hypertension)) +
  geom_point()

life_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = life_expectancy)) +
  geom_point()

self_health_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = self_rep_health)) +
  geom_point()

avg_rev_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = avg_rev_value)) +
  geom_point()

avg_appr_plot &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = garden_num, y = avg_tot_appropriated)) +
  geom_point()

poverty_plot + avg_appr_plot + avg_rev_plot + life_plot + obesity_plot + hypertension_plot + self_health_plot + plot_layout(ncol = 3)</code></pre>
<pre><code>## Warning: Removed 15 rows containing missing values (geom_point).</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-2-1.png" width="90%" /></p>
<p>Check normal ish distribution of outcome - all are mostly normally distributed except average revenue value. Hypertension is bimodal, not sure if we can use this moving forward.</p>
<pre class="r"><code>pov_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = poverty)) +
  geom_density()

obes_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = obesity)) +
  geom_density()

hypert_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = hypertension)) +
  geom_density()

life_exp_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = life_expectancy)) +
  geom_density()

self_health_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = self_rep_health)) +
  geom_density()

tot_appr_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = avg_tot_appropriated)) +
  geom_density()

rev_value_density &lt;-
analysis_data_final %&gt;% 
  ggplot(aes(x = avg_rev_value)) +
  geom_density()

pov_density + tot_appr_density + rev_value_density + life_exp_density + obes_density + hypert_density + self_health_density + plot_layout(ncol = 3)</code></pre>
<pre><code>## Warning: Removed 15 rows containing non-finite values (stat_density).</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-3-1.png" width="90%" /></p>
<p>Predictor: garden number Confounder: Poverty Outcomes: average total appropriated, hypertension, life expectancy, obesity, self-reported health</p>
</div>
<div id="test-spatial-autocorrelation" class="section level3">
<h3>Test spatial autocorrelation</h3>
<p>Check spatial dependence (non-random distribution) of variables using Moran’s I. A significant Moran’s I indicates the values are clustered and not spatially independent - therefore we should adjust for spatial parameter in our model.</p>
<pre class="r"><code>###Create a queen&#39;s neighborhood weight matrix using the poly2nb command.
analysis_nbq &lt;- poly2nb(analysis_data_spatial)

###extract coordinates to plot the connectivity matrix for visualization.
coords &lt;- coordinates(analysis_data_spatial)

###convert the neighborhood matrix into a list so that the connections between counties can be used in Moran&#39;s I test.
analysis_nbq_w &lt;- nb2listw(analysis_nbq)</code></pre>
<pre class="r"><code>###Garden number
###Convert Exposure variable to z-form and then create the lag of that variable.
analysis_data_spatial@data$garden_num &lt;- scale(analysis_data_spatial@data$garden_num)
analysis_data_spatial@data$lag_sQL &lt;- lag.listw(analysis_nbq_w,analysis_data_spatial@data$garden_num)

### Lose spatial properties when we turn into data frame for analysis
analysis_sp_data &lt;- as.data.frame(analysis_data_spatial)

###Run morans I test and plot the results.
garden_moran &lt;- moran.test(analysis_data_spatial@data$garden_num, listw = analysis_nbq_w, zero.policy = TRUE)
broom::tidy(garden_moran)</code></pre>
<pre><code>## # A tibble: 1 x 7
##   estimate1 estimate2 estimate3 statistic p.value method             alternative
##       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;      
## 1     0.190   -0.0175   0.00887      2.20  0.0138 Moran I test unde… greater</code></pre>
<pre class="r"><code>moran.plot(as.vector(analysis_data_spatial@data$garden_num), listw = analysis_nbq_w, 
           xlim = c(-2,4),ylim = c(-2,2),
                 main = &quot;Moran&#39;s I = 0.1899, p-value = 0.0138&quot;, 
           xlab = &quot;Garden Number&quot;, ylab = &quot;Spatial Lag Number of Gardens&quot;, pch = 19)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-5-1.png" width="90%" /></p>
<pre class="r"><code>###Poverty
###Convert Exposure variable to z-form and then create the lag of that variable.
analysis_data_spatial@data$poverty &lt;- scale(analysis_data_spatial@data$poverty)
analysis_data_spatial@data$lag_sQL_p &lt;- lag.listw(analysis_nbq_w,analysis_data_spatial@data$poverty)

### Lose spatial properties when we turn into data frame for analysis
analysis_sp_data &lt;- as.data.frame(analysis_data_spatial)

###Run morans I test and plot the results.
moran.test(analysis_data_spatial@data$poverty, listw = analysis_nbq_w, zero.policy = TRUE)</code></pre>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  analysis_data_spatial@data$poverty  
## weights: analysis_nbq_w    
## 
## Moran I statistic standard deviate = 5.0556, p-value = 2.145e-07
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.478672271      -0.017543860       0.009633691</code></pre>
<pre class="r"><code>moran.plot(as.vector(analysis_data_spatial@data$poverty), listw = analysis_nbq_w, 
           xlim = c(-2,4),ylim = c(-2,2),
                 main = &quot;Moran&#39;s I = 0.4787, p-value &lt; 0.0001&quot;, 
           xlab = &quot;Poverty&quot;, ylab = &quot;Spatial Lag Poverty&quot;, pch = 19)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-6-1.png" width="90%" /></p>
<pre class="r"><code>###Obesity
###Convert outcome variable to z-form and then create the lag of that variable.
analysis_data_spatial@data$obesity &lt;- scale(analysis_data_spatial@data$obesity)
analysis_data_spatial@data$lag_sQL_o &lt;- lag.listw(analysis_nbq_w,analysis_data_spatial@data$obesity)

### Lose spatial properties when we turn into data frame for analysis
analysis_sp_data &lt;- as.data.frame(analysis_data_spatial)

###Run morans I test and plot the results.
moran.test(analysis_data_spatial@data$obesity, listw = analysis_nbq_w, zero.policy = TRUE)</code></pre>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  analysis_data_spatial@data$obesity  
## weights: analysis_nbq_w    
## 
## Moran I statistic standard deviate = 7.4269, p-value = 5.558e-14
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.707506707      -0.017543860       0.009530619</code></pre>
<pre class="r"><code>moran.plot(as.vector(analysis_data_spatial@data$obesity), listw = analysis_nbq_w, 
           xlim = c(-2,4),ylim = c(-2,2),
                 main = &quot;Moran&#39;s I = 0.7075, p-value &lt; 0.0001&quot;, 
           xlab = &quot;Obesity&quot;, ylab = &quot;Spatial Lag Obesity&quot;, pch = 19)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-7-1.png" width="90%" /></p>
<pre class="r"><code>###Life Expectancy
###Convert outcome variable to z-form and then create the lag of that variable.
analysis_data_spatial@data$life_expectancy &lt;- scale(analysis_data_spatial@data$life_expectancy)
analysis_data_spatial@data$lag_sQL_l &lt;- lag.listw(analysis_nbq_w,analysis_data_spatial@data$life_expectancy)

### Lose spatial properties when we turn into data frame for analysis
analysis_sp_data &lt;- as.data.frame(analysis_data_spatial)

###Run morans I test and plot the results.
moran.test(analysis_data_spatial@data$life_expectancy, listw = analysis_nbq_w, zero.policy = TRUE)</code></pre>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  analysis_data_spatial@data$life_expectancy  
## weights: analysis_nbq_w    
## 
## Moran I statistic standard deviate = 5.6454, p-value = 8.24e-09
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##        0.53543065       -0.01754386        0.00959445</code></pre>
<pre class="r"><code>moran.plot(as.vector(analysis_data_spatial@data$life_expectancy), listw = analysis_nbq_w, 
           xlim = c(-2,4),ylim = c(-2,2),
                 main = &quot;Moran&#39;s I = 0.5354, p-value &lt; 0.0001&quot;, 
           xlab = &quot;Life Expectancy&quot;, ylab = &quot;Spatial Lag Life Expectancy&quot;, pch = 19)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-8-1.png" width="90%" /></p>
<p>###Fit Preliminary Models: 1. Life expectancy = garden_num + poverty 2. Obesity = garden_num + poverty</p>
<p>Test baseline linear models and do spatial diagnostics to choose appropriate spatial model.</p>
<pre class="r"><code>###Test baseline linear model.
obesity_lm &lt;- lm(obesity ~ garden_num + poverty, data = analysis_data_spatial)
broom::tidy(obesity_lm)</code></pre>
<pre><code>## # A tibble: 3 x 5
##   term         estimate std.error statistic      p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
## 1 (Intercept) -9.46e-17    0.0975 -9.70e-16 1.00        
## 2 garden_num   9.86e- 2    0.105   9.42e- 1 0.350       
## 3 poverty      6.44e- 1    0.105   6.15e+ 0 0.0000000927</code></pre>
<pre class="r"><code>broom::glance(obesity_lm)</code></pre>
<pre><code>## # A tibble: 1 x 12
##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.468         0.448 0.743      24.2 2.95e-8     2  -63.5  135.  143.
## # … with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
<pre class="r"><code>summary(obesity_lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = obesity ~ garden_num + poverty, data = analysis_data_spatial)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.7488 -0.3938 -0.0024  0.5021  1.2312 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -9.460e-17  9.753e-02   0.000     1.00    
## garden_num   9.864e-02  1.047e-01   0.942     0.35    
## poverty      6.438e-01  1.047e-01   6.148 9.27e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7428 on 55 degrees of freedom
## Multiple R-squared:  0.4677, Adjusted R-squared:  0.4483 
## F-statistic: 24.16 on 2 and 55 DF,  p-value: 2.95e-08</code></pre>
<pre class="r"><code>life_expectancy_lm &lt;- lm(life_expectancy ~ garden_num + poverty, data = analysis_data_spatial)
summary(life_expectancy_lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = life_expectancy ~ garden_num + poverty, data = analysis_data_spatial)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.42008 -0.44642 -0.01881  0.49210  1.51925 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -8.524e-17  9.273e-02   0.000 1.000000    
## garden_num  -5.043e-01  9.956e-02  -5.065 4.91e-06 ***
## poverty     -3.698e-01  9.956e-02  -3.715 0.000477 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7062 on 55 degrees of freedom
## Multiple R-squared:  0.5188, Adjusted R-squared:  0.5013 
## F-statistic: 29.65 on 2 and 55 DF,  p-value: 1.836e-09</code></pre>
<pre class="r"><code>broom::tidy(life_expectancy_lm)</code></pre>
<pre><code>## # A tibble: 3 x 5
##   term         estimate std.error statistic    p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 (Intercept) -8.52e-17    0.0927 -9.19e-16 1.00      
## 2 garden_num  -5.04e- 1    0.0996 -5.07e+ 0 0.00000491
## 3 poverty     -3.70e- 1    0.0996 -3.71e+ 0 0.000477</code></pre>
<pre class="r"><code>###Look at residuals for life expectancy: 
par(mfrow = c(2,2))
plot(life_expectancy_lm)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-10-1.png" width="90%" /></p>
<pre class="r"><code>###Map residuals to see spatial dependence for the basic linear model: 
resids &lt;- residuals(life_expectancy_lm)
map.resids &lt;- cbind(analysis_data_spatial, resids)
# we need to rename the column header from the resids file
# in this case its the 6th column of map.resids
names(map.resids)[14] &lt;- &quot;resids&quot;
# maps the residuals using the quickmap function from tmap
qtm(map.resids, fill = &quot;resids&quot;, palette = &quot;div&quot;)</code></pre>
<pre class="r"><code>###Run Langrane Multiplier tests to identify the type of spatial regression model to run.
obesity.lagrange &lt;- lm.LMtests(obesity_lm, analysis_nbq_w, test = c(&quot;LMerr&quot;,&quot;RLMerr&quot;,&quot;LMlag&quot;,&quot;RLMlag&quot;,&quot;SARMA&quot;))
print(obesity.lagrange)</code></pre>
<pre><code>## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = obesity ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## LMerr = 19.253, df = 1, p-value = 1.145e-05
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = obesity ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## RLMerr = 0.80198, df = 1, p-value = 0.3705
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = obesity ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## LMlag = 34.342, df = 1, p-value = 4.623e-09
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = obesity ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## RLMlag = 15.891, df = 1, p-value = 6.709e-05
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = obesity ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## SARMA = 35.144, df = 2, p-value = 2.337e-08</code></pre>
<pre class="r"><code>life_expectancy.lagrange &lt;- lm.LMtests(life_expectancy_lm,analysis_nbq_w, test = c(&quot;LMerr&quot;,&quot;RLMerr&quot;,&quot;LMlag&quot;,&quot;RLMlag&quot;,&quot;SARMA&quot;))
print(life_expectancy.lagrange)</code></pre>
<pre><code>## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = life_expectancy ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## LMerr = 17.639, df = 1, p-value = 2.67e-05
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = life_expectancy ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## RLMerr = 0.16406, df = 1, p-value = 0.6854
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = life_expectancy ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## LMlag = 24.495, df = 1, p-value = 7.452e-07
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = life_expectancy ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## RLMlag = 7.0196, df = 1, p-value = 0.008062
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = life_expectancy ~ garden_num + poverty, data =
## analysis_data_spatial)
## weights: analysis_nbq_w
## 
## SARMA = 24.659, df = 2, p-value = 4.42e-06</code></pre>
</div>
<div id="fit-spatial-regression-model" class="section level3">
<h3>Fit spatial regression model</h3>
<pre class="r"><code>###Specify Spatial Lag Model
life_exp.lag &lt;- spatialreg::lagsarlm(life_expectancy ~ garden_num + poverty, data = analysis_data_spatial, analysis_nbq_w, tol.solve = 1.0e-15)
###Spatial error model 
life_exp.err &lt;- spatialreg::errorsarlm(life_expectancy ~ garden_num + poverty, data = analysis_data_spatial, analysis_nbq_w, tol.solve = 1.0e-15)
###Mixed model (SARMA significant)
htn.sar &lt;- spatialreg::lagsarlm(hypertension ~ garden_num + poverty, data = analysis_data_spatial, analysis_nbq_w, type = &quot;mixed&quot;, tol.solve = 1.0e-15)

summary(life_exp.lag)</code></pre>
<pre><code>## 
## Call:spatialreg::lagsarlm(formula = life_expectancy ~ garden_num + 
##     poverty, data = analysis_data_spatial, listw = analysis_nbq_w, 
##     tol.solve = 1e-15)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -1.357648 -0.362085 -0.043034  0.393640  1.450865 
## 
## Type: lag 
## Coefficients: (asymptotic standard errors) 
##              Estimate Std. Error z value  Pr(&gt;|z|)
## (Intercept)  0.013654   0.072043  0.1895  0.849683
## garden_num  -0.433979   0.078254 -5.5458 2.927e-08
## poverty     -0.238085   0.080248 -2.9669  0.003009
## 
## Rho: 0.49213, LR test value: 21.678, p-value: 3.2246e-06
## Asymptotic standard error: 0.096519
##     z-value: 5.0988, p-value: 3.4187e-07
## Wald statistic: 25.997, p-value: 3.4187e-07
## 
## Log likelihood: -49.74222 for lag model
## ML residual variance (sigma squared): 0.30078, (sigma: 0.54844)
## Number of observations: 58 
## Number of parameters estimated: 5 
## AIC: 109.48, (AIC for lm: 129.16)
## LM test for residual autocorrelation
## test value: 0.40136, p-value: 0.52639</code></pre>
<pre class="r"><code>###Look at residuals for life expectancy for spatial lag model: 
analysis_data_spatial$residuals &lt;- residuals(life_exp.lag)
moran.mc(analysis_data_spatial$residuals, analysis_nbq_w, 999)</code></pre>
<pre><code>## 
##  Monte-Carlo simulation of Moran I
## 
## data:  analysis_data_spatial$residuals 
## weights: analysis_nbq_w  
## number of simulations + 1: 1000 
## 
## statistic = -0.041692, observed rank = 433, p-value = 0.567
## alternative hypothesis: greater</code></pre>
<pre class="r"><code>###Map residuals to see spatial dependence for the spatial lag linear model: 
resids &lt;- residuals(life_exp.lag)
map.resids_spatial &lt;- cbind(analysis_data_spatial, resids)
# we need to rename the column header from the resids file
names(map.resids_spatial)[14] &lt;- &quot;resids&quot;
# maps the residuals using the quickmap function from tmap
#qtm(map.resids_spatial, fill = &quot;resids&quot;)</code></pre>
<pre class="r"><code>###Plot predictions for model
###???</code></pre>
<p>Notes: I decided to just go with garden number not transformed, even though it’s not super linear. The model basically works like that, and when I ran the residuals diagnostics it didn’t look too bad so maybe it’s fine? I’m not exactly sure how to plot the predictions from the spatial model.</p>
<p>Also how many models should we do? Because if we do a bunch I think we run into the issue of having too high of an alpha</p>
</div>
<div id="to-do" class="section level3">
<h3>To do:</h3>
<p>Check that we understand the spatial diagnostics &amp; regular diagnostics of our models: -residuals normally distributed / equal variance / not spatially correlated<br />
-check r^2 for model fit</p>
<p>Clean up model output to visualize: - Table of betas and se - plot the actual linear model over data points</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
